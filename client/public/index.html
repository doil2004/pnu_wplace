<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>PNU-WPLACE</title>
    <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    
    <link rel="stylesheet" href="./styles.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script src="../src/test.js"></script> <!-- 격자 확인용으로 넣어본 부분 -->
    <script src="../src/elements/pixel.js"></script>
    <script src="../src/elements/color-picker.js"></script>
    <script src="../src/elements/auth-card.js"></script>
  </head>
  <body>
    
    <div id="map"></div>
    
    <div id="color-picker">
      <span>색 선택:</span>
    </div>

    <div id="auth-card" class="card auth-card" 
      data-mode="login"
      data-logged-in=false
    >
      <div class="logged-out">
        <div class="auth-tabs">
          <button class="auth-tab active" data-mode="login">로그인</button>
          <button class="auth-tab" data-mode="register">회원가입</button>
        </div>

        <form class="login-form">
          <input id="login-email" class="auth-field" 
            type="email" name="email" required
            placeholder="이메일"
          />
          <input id="login-password" class="auth-field" 
            type="password" name="password" required
            placeholder="비밀번호"
          />
          <button type="submit" class="auth-submit">로그인</button>
        </form>

        <form class="register-form">
          <input id="register-email" class="auth-field" 
            type="email" name="email" required
            placeholder="이메일"
          />
          <input id="register-password" class="auth-field" 
            type="password" name="password" required
            placeholder="비밀번호"
          />
          <input id="register-nickname" class="auth-field" 
            type="nickname" name="nickname"
            placeholder="닉네임"
          />
          <button type="submit" class="auth-submit">로그인</button>
        </form>
      </div>
      <div class="logged-in">
        <p><strong class="me-nickname"></strong>님 안녕하세요!</p>
        <button class="logout-btn">로그아웃</button>
        <p style="margin-top:6px; font-size:12px; color:#555;">
          · 지도를 클릭 → <br>
          &nbsp;&nbsp;셀 선택 후 아래에서 색 선택 <br>
          · 칠해진 칸 위에 마우스를 올리면<br>
          &nbsp;&nbsp;닉네임이 표시됩니다.
        </p>
      </div>
    </div>
    <script>
      const auth = new AuthCard("auth-card");
    </script>

    <script>
      // 부산대 영역
      const pnuBounds = L.latLngBounds(
        [35.227, 129.077], // 남서
        [35.237, 129.092]  // 북동
      );

      // 지도 생성
      const map = L.map('map', {
        center: [35.232, 129.084],
        zoom: 16,
        minZoom: 15,
        maxZoom: 19,
        maxBounds: pnuBounds,
        maxBoundsViscosity: 1.0
      });

      // 기본 타일 레이어
      L.tileLayer(
        'https://{s}.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}.png',
        {
          attribution: '&copy; OpenStreetMap, &copy; CARTO',
          subdomains: 'abcd',
          maxZoom: 20
        }
      ).addTo(map);
      
      const COLORS = [
        '#ff3b30', // 빨강
        '#ff9500', // 주황
        '#ffcc00', // 노랑
        '#34c759', // 초록
        '#007aff', // 파랑
        '#5856d6', // 남보라
        '#af52de', // 보라
      ];
      
      const colorPicker = new ColorPicker("color-picker", COLORS);

      map.whenReady(() => {
        console.log('[Debug] map ready, adding layers');
        
        const pixelLayer = new PixelGridLayer();
        pixelLayer.addTo(map).bringToFront();
        
        map.on('click', (e) => {
          pixelLayer.paintPixelAt(e.latlng, colorPicker.currentColor);
        });
      });
      
      function showDebugLayer() {
        const debugLayer = new DebugGridLayer();
        debugLayer.addTo(map).bringToFront();
      }

    </script>
  </body>
</html>